# 0002. Ограничения доступа(Только для админов) 

## Дата
2025-07-24

## Контекст
В Telegram-боте реализуются различные хендлеры (обработчики команд и колбэков), часть из которых должна быть доступна только администраторам.
При этом хендлеры содержат полезную бизнес-логику, которую желательно сохранять чистой и переиспользуемой — например, вызывать её из других команд, админских панелей, cron-задач и т.п.
На практике возникает необходимость:
- централизованно проверять права доступа к хендлерам,
- не дублировать логику или не усложнять сигнатуры функций,
- использовать единый способ отказа в доступе (например, отправка сообщения и выход),
- иметь возможность гибко управлять доступом на этапе регистрации хендлеров, а не только внутри тела функции.

Важно, чтобы архитектура позволяла:
- отделить логику доступа от логики задачи,
- использовать одну и ту же функцию как с проверкой, так и без неё (например, в тестах или вспомогательных вызовах),
- сохранить прозрачность и читаемость кода.

## Решение
Создан декоратор @only_admin, который оборачивает хендлер. 
Если пользователь не является администратором, декоратор возвращает исключение (или завершает выполнение с сообщением).
Реализация поддерживает два способа использования:
    Функциональное оборачивание при регистрации хендлера:
    Основная логика остаётся чистой (statistics()), проверка добавляется при регистрации.

```python
CallbackQueryHandler(only_admin(statistics), pattern="^statistics$")
```

Обертывание декоратором при объявлении хендлера:
    Проверка доступа встроена прямо в определение функции.

```python
@only_admin
def statistics_handler(update, context):
    ...
```

В обоих случаях, если пользователь не обладает правами администратора, дальнейшее выполнение функции блокируется.


## Альтернативы
Описывать логику внутри каждого хендера

## Последствия
Чистую логику (statistics) можно вызывать из других мест без зависимости от Telegram или прав.
Поведение проверки становится единообразным и централизованным.
Возможность гибко управлять уровнем доступа при подключении хендлеров.

## Ретроспектива

## Статус
**Принято** — решение утверждено и применяется
