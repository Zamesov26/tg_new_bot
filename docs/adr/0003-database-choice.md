# 0003. Выбор базы данных и ORM

## Дата
2025-08-27

## Статус
Accepted

## Контекст
Для проекта Telegram-бота необходима система управления базами данных для хранения информации о пользователях, программах, заказах и других сущностях. Необходимо выбрать подходящую СУБД и ORM для работы с ней.

Требования к выбору:
- Поддержка асинхронных операций
- Надежность и стабильность
- Хорошая документация и сообщество
- Совместимость с существующим стеком технологий (Python, aiohttp)
- Поддержка миграций схемы базы данных
- Возможность работы с PostgreSQL (исходя из конфигурации проекта)

## Решение
Выбрана PostgreSQL в качестве СУБД и SQLAlchemy в качестве ORM с поддержкой асинхронных операций.

### Обоснование выбора PostgreSQL:
1. Открытый исходный код и надежность
2. Хорошая поддержка сложных запросов и транзакций
3. Широкое распространение и хорошая документация
4. Поддержка JSON и других современных типов данных
5. Соответствует конфигурации проекта

### Обоснование выбора SQLAlchemy:
1. Зрелая и стабильная ORM с отличной документацией
2. Поддержка асинхронных операций через sqlalchemy.ext.asyncio
3. Гибкость в работе с запросами - можно использовать как ORM, так и SQL напрямую
4. Интеграция с Alembic для миграций
5. Широкое использование в сообществе Python
6. Поддержка различных СУБД

## Альтернативы
1. **Tortoise ORM**:
   - Плюсы: Асинхронная ORM, похожая на Django ORM
   - Минусы: Меньше возможностей по сравнению с SQLAlchemy, меньшее сообщество
   
2. **Django ORM**:
   - Плюсы: Знаком многим разработчикам, богатые возможности
   - Минусы: Тесная связь с Django, сложность интеграции с aiohttp
   
3. **Raw SQL с asyncpg**:
   - Плюсы: Максимальная производительность, полный контроль
   - Минусы: Больше boilerplate кода, сложнее поддерживать миграции

## Последствия
**Положительные**:
- Надежная и проверенная комбинация PostgreSQL + SQLAlchemy
- Поддержка асинхронных операций
- Возможность использовать Alembic для миграций
- Гибкость в работе с данными

**Отрицательные**:
- Более сложная настройка по сравнению с более простыми ORM
- Потенциальный оверхед по сравнению с raw SQL

## Ретроспектива
После внедрения решения оказалось, что SQLAlchemy хорошо справляется с задачами проекта. Использование asyncpg в качестве драйвера обеспечивает хорошую производительность.

## Связанные ADR
- 0001. передача сущностей в ручку