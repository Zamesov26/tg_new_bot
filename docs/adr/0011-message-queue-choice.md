# 0011. Выбор очереди сообщений

## Дата
2025-08-27

## Статус
 superseded

## Контекст
Для асинхронной обработки задач и масштабирования компонентов системы необходимо выбрать систему очередей сообщений.

Требования:
- Поддержка асинхронной обработки
- Надежность и гарантии доставки
- Масштабируемость
- Интеграция с Python
- Мониторинг и управление очередями

## Решение
~~Использовать RabbitMQ с библиотекой aio-pika для асинхронной работы.~~

### Обоснование выбора RabbitMQ:
1. Зрелая и стабильная система очередей
2. Богатые возможности маршрутизации сообщений
3. Хорошая документация и сообщество
4. Поддержка различных протоколов (AMQP)
5. Возможность кластеризации для высокой доступности
6. Интеграция с aio-pika для асинхронной работы в Python

### Использование в проекте:
1. Обработка входящих сообщений от Telegram
2. Отправка уведомлений
3. Фоновая обработка задач (TODO: Уточнить конкретные задачи)

### Интеграция:
1. aio-pika для асинхронной работы с RabbitMQ
2. Отдельный модуль message_service для работы с очередями
3. Retry mechanism при ошибках обработки

## Альтернативы
1. **Apache Kafka**:
   - Плюсы: Высокая пропускная способность, persistence, распределенность
   - Минусы: Более сложная архитектура, избыточность для текущих потребностей
   
2. **Amazon SQS/Google Pub/Sub**:
   - Плюсы: Управляемые сервисы, интеграция с облаком
   - Минусы: Зависимость от облака, затраты, необходимость интернет-соединения
   
3. **Celery с Redis/RabbitMQ**:
   - Плюсы: Высокоуровневый API, богатые возможности
   - Минусы: Избыточность, необходимость изучения Celery

## Последствии
**Положительные**:
- Асинхронная обработка задач
- Повышение отказоустойчивости системы
- Возможность горизонтального масштабирования обработчиков
- Разделение ответственности между компонентами

**Отрицательные**:
- Дополнительная сложность архитектуры
- Необходимость управления еще одним сервисом
- Потенциальные проблемы с порядком обработки сообщений

## Ретроспектива
RabbitMQ хорошо справляется с задачами проекта. aio-pika обеспечивает удобную интеграцию с асинхронным кодом.

## Связанные ADR
- 0003. Выбор базы данных и ORM
- 0004. Стратегия развертывания

## TODO
Система очередей сообщений будет reintroduced позже с улучшенной архитектурой и реализацией.