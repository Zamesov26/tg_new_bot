# 0005. Обработка ошибок и логирование

## Дата
2025-08-27

## Статус
Accepted

## Контекст
Для обеспечения стабильной работы Telegram-бота и возможности диагностики проблем необходимо определить стратегию обработки ошибок и логирования.

Требования:
- Централизованное логирование
- Различные уровни логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- Структурированные логи для последующего анализа
- Обработка исключений на разных уровнях приложения
- Мониторинг критических ошибок

## Решение
Использовать стандартную библиотеку logging Python с настройкой уровней логирования и форматированием сообщений.

### Логирование:
1. Использование logging.getLogger() для получения логгеров в каждом модуле
2. Настройка базового уровня логирования через logging.basicConfig()
3. Структурированные сообщения с указанием времени, уровня, модуля и сообщения
4. Логирование в stdout/stderr для совместимости с Docker

### Обработка ошибок:
1. Централизованная обработка исключений в слое доступа к Telegram API
2. Декораторы для обработки типичных ошибок
3. Логирование ошибок с контекстом выполнения
4. Graceful degradation при ошибках взаимодействия с внешними сервисами

## Альтернативы
1. **Сторонние библиотеки логирования (loguru, structlog)**:
   - Плюсы: Более удобный API, структурированные логи "из коробки"
   - Минусы: Дополнительная зависимость, необходимость обучения
   
2. **Sentry для мониторинга ошибок**:
   - Плюсы: Удобный интерфейс, уведомления, трекинг ошибок
   - Минусы: Дополнительная зависимость, необходимость настройки сервера или использования облака
   
3. **ELK Stack (Elasticsearch, Logstash, Kibana)**:
   - Плюсы: Мощные возможности анализа логов
   - Минусы: Сложность настройки, ресурсоемкость

## Последствия
**Положительные**:
- Простота реализации и поддержки
- Совместимость со стандартными практиками Python
- Минимальные накладные расходы
- Возможность расширения при необходимости

**Отрицательные**:
- Ограниченные возможности структурированного логирования
- Отсутствие автоматических уведомлений об ошибках
- Сложность анализа логов в больших объемах

## Ретроспектива
Базовая система логирования работает хорошо, но для production-окружения может потребоваться расширение возможностей (Sentry, структурированные логи).

## Связанные ADR
- 0004. Стратегия развертывания