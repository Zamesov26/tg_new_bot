# DR-0001. Отключение проверки SSL-сертификатов

## Заголовок
Отключение проверки SSL-сертификатов в HTTP-клиентах

## Контекст
Проблема обнаружена в двух файлах:
1. `app/tg_api/accessor.py` - в классе TgApiAccessor при создании HTTP-сессии
2. `message_service/accessor.py` - в классе TgApiAccessor при создании HTTP-сессии

Эта проблема затрагивает безопасность взаимодействия с Telegram API и потенциально другие внешние сервисы. Проблема была идентифицирована как технический долг в TDR-0001 и как серьезная проблема в PDR-0001.

## Проблема / Долг
В коде используется параметр `verify_ssl=False` при создании TCPConnector для aiohttp ClientSession:
```python
self.session = ClientSession(connector=TCPConnector(verify_ssl=False))
```

Это отключает проверку SSL-сертификатов, что представляет серьезную угрозу безопасности. При таком подходе приложение уязвимо к атакам "человек посередине" (MITM), когда злоумышленник может перехватить и изменить данные, передаваемые между клиентом и сервером.

Отключение проверки SSL-сертификатов представляет собой серьезную уязвимость безопасности, которая может привести к атакам типа "человек посередине" (MITM). Это временный хак, который был добавлен для упрощения разработки или из-за проблем с сертификатами, но не должен использоваться в production-среде.

## Возможные варианты решения

1. **Включить проверку SSL-сертификатов**:
   - Сильные стороны: Быстрое решение, повышение безопасности
   - Слабые стороны: Может потребоваться настройка доверенных сертификатов, возможны проблемы с самоподписанными сертификатами

2. **Использовать пользовательский контекст SSL**:
   - Сильные стороны: Гибкость в настройке, возможность указать конкретные сертификаты
   - Слабые стороны: Более сложная реализация, необходимость управления сертификатами

3. **Конфигурируемая проверка SSL**:
   - Сильные стороны: Возможность отключения проверки в development-среде и включения в production
   - Слабые стороны: Риск случайного отключения в production, усложнение конфигурации

## Принятое решение / Компромисс
TODO: Необходимо определить, какое решение будет принято для устранения проблемы. Рекомендуется включить проверку SSL-сертификатов и при необходимости настроить доверие к сертификатам Telegram API.

## Последствия
Если проблема будет решена путем включения проверки SSL:
- Плюсы: Повышение безопасности, защита от MITM-атак, соответствие лучшим практикам
- Минусы: Возможные проблемы с подключением, если сертификаты не настроены правильно

Если проблема останется без изменений:
- Плюсы: Отсутствие необходимости в изменениях, совместимость с текущим кодом
- Минусы: Серьезная уязвимость безопасности, риск компрометации токенов и данных, потенциальная компрометация данных, передаваемых между сервисами, уязвимость к атакам MITM, несоответствие требованиям безопасности, риск утечки токенов и другой конфиденциальной информации

## План исправления / развития
1. Исследовать причину, по которой была отключена проверка SSL
2. Исправить проблему с сертификатами или настроить правильное доверие к сертификатам
3. Удалить `verify_ssl=False` и включить проверку сертификатов
4. Протестировать работоспособность после изменения

## Статус
Open

## Комментарии
Решение этой проблемы должно быть приоритетным, так как она напрямую влияет на безопасность приложения. Проблема также упоминается в анализе library_extraction_bot_engine_and_tg_api.md.

## TODO
Определить, какое решение будет принято для устранения проблемы. Рекомендуется включить проверку SSL-сертификатов и при необходимости настроить доверие к сертификатам Telegram API.