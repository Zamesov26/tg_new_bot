# DR-0012. Несоответствия в коде и потенциальные баги

## Заголовок
Несоответствия в коде и потенциальные баги, выявленные анализом

## Контекст
В ходе анализа кода обнаружены следующие несоответствия и потенциальные проблемы:
1. В `app/bot_engine/handlers.py` есть TODO-комментарий: "# TODO заменить на нормальный фильтр"
2. В `app/bot_engine/handlers.py` есть TODO-комментарий: "# TODO вытащить fsm в отдельный слой"
3. В `app/wonderland/handlers/main_menu.py` есть несколько TODO-комментариев, связанных с отправкой сообщений в брокер
4. В файлах с миграциями и кэше ruff обнаружены фрагменты кода, указывающие на возможные проблемы

Эта проблема была идентифицирована как технический долг в TDR-0012.

## Проблема / Долг
Наличие множества TODO-комментариев указывает на незавершенную работу или временные решения, которые требуют доработки. Эти проблемы могут привести к нестабильной работе приложения или отсутствию важной функциональности.

## Возможные варианты решения

1. **Постепенное устранение TODO**:
   - Сильные стороны: Минимальное влияние на текущую разработку, возможность приоритизации
   - Слабые стороны: Долгий процесс, TODO могут накапливаться дальше

2. **Блокировка новых функций до устранения TODO**:
   - Сильные стороны: Гарантированное устранение технического долга, повышение качества кода
   - Слабые стороны: Замедление разработки новых функций, потенциальное сопротивление команды

3. **Создание задач в системе управления задачами**:
   - Сильные стороны: Системный подход, возможность отслеживания прогресса
   - Слабые стороны: Требует дополнительного инструмента и процессов

## Принятое решение / Компромисс
TODO: Необходимо определить системный подход к работе с TODO-комментариями. Рекомендуется провести инвентаризацию всех TODO и создать задачи в системе управления задачами.

## Последствии
Если проблема будет решена системно:
- Плюсы: Повышение качества кода, завершение недоделанной функциональности, уменьшение технического долга
- Минусы: Временные затраты на устранение, необходимость принятия архитектурных решений

Если проблема останется без изменений:
- Плюсы: Отсутствие временных затрат
- Минусы: Накопление технического долга, потенциальные ошибки в работе, неполная функциональность

## План исправления / развития
1. Провести инвентаризацию всех TODO-комментариев в проекте
2. Приоритизировать задачи по важности и влиянию на функциональность
3. Постепенно реализовать недостающую функциональность
4. Удалить или заменить временные решения на полноценные реализации
5. Добавить тесты для проверки новой функциональности
6. Обновить документацию в соответствии с изменениями

## Статус
Open

## Комментарии
Многие TODO указывают на серьезные архитектурные проблемы, которые требуют внимания. Особенно критичны TODO, связанные с безопасностью (DR-0001) и управлением ресурсами (DR-0003).

## TODO
Определить системный подход к работе с TODO-комментариями. Рекомендуется провести инвентаризацию всех TODO и создать задачи в системе управления задачами.