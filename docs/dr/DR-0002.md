# DR-0002. Хардкодинг секретов в коде

## Заголовок
Хардкодинг секретов и токенов в исходном коде

## Контекст
Проблема обнаружена в нескольких файлах:
1. `message_service/accessor.py` - Telegram-токен бота
2. `app/config.py` - пароль к базе данных по умолчанию
3. `admin_panel/admin_panel/settings.py` - секретный ключ Django
4. `etc/config.yml` - конфигурационный файл с секретами

Эта проблема затрагивает безопасность всего приложения и потенциальную компрометацию всех захардкоженных секретов. Проблема была идентифицирована как технический долг в TDR-0002 и как серьезная проблема в PDR-0002.

## Проблема / Долг
В коде и конфигурационных файлах хранятся секреты в открытом виде:
1. В `message_service/accessor.py`: `TOKEN = "6571525696:AAExhmgaO0zfqIAAzhgnKRBKxQ3jDbsa8ng"`
2. В `app/config.py`: `password: str = "postgres"` (значение по умолчанию)
3. В `etc/config.yml`: пароль к базе данных и токен бота в открытом виде
4. В `admin_panel/admin_panel/settings.py`: секретный ключ Django

Это представляет серьезную угрозу безопасности, так как при публикации кода в репозитории или его передаче третьим лицам эти секреты становятся доступны всем.

Хранение секретов прямо в коде представляет серьезную угрозу безопасности. При публикации кода в репозитории или его передаче третьим лицам эти секреты становятся доступны всем. Это нарушает лучшие практики безопасности и делает приложение уязвимым.

## Возможные варианты решения

1. **Использование переменных окружения**:
   - Сильные стороны: Простая реализация, широкое распространение подхода, совместимость с большинством платформ
   - Слабые стороны: Необходимость настройки окружения, потенциальные проблемы с локальной разработкой

2. **Использование файлов конфигурации вне репозитория**:
   - Сильные стороны: Гибкость, возможность хранения сложных структур, контроль доступа к файлам
   - Слабые стороны: Необходимость управления файлами, риск случайного добавления в репозиторий

3. **Использование специализированных систем управления секретами**:
   - Сильные стороны: Высокий уровень безопасности, централизованное управление, аудит доступа
   - Слабые стороны: Дополнительная сложность, зависимость от внешних сервисов, необходимость настройки

## Принятое решение / Компромисс
TODO: Необходимо определить, какой подход будет использоваться для управления секретами. Рекомендуется использовать переменные окружения как минимальный подход и рассмотреть специализированные системы управления секретами для production-среды.

## Последствия
Если проблема будет решена:
- Плюсы: Повышение безопасности, защита от компрометации секретов, соответствие лучшим практикам
- Минусы: Необходимость изменения кода и конфигурации, необходимость настройки окружения

Если проблема останется без изменений:
- Плюсы: Отсутствие необходимости в изменениях
- Минусы: Серьезная уязвимость безопасности, риск компрометации всех захардкоженных секретов, потенциальная компрометация всех захардкоженных секретов, риск несанкционированного доступа к Telegram-боту, риск получения доступа к базе данных, риск компрометации админ-панели Django

## План исправления / развития
1. Перенести все секреты в переменные окружения
2. Использовать файлы конфигурации вне репозитория (например, .env)
3. Настроить правильное управление секретами (например, через HashiCorp Vault или аналогичные решения)
4. Обновить код для чтения секретов из безопасных источников
5. Удалить захардкоженные значения из кода
6. Обновить документацию по развертыванию
7. Необходимо также добавить конфигурационные файлы с секретами в .gitignore, чтобы избежать их случайной публикации

## Статус
Open

## Комментарии
Необходимо также добавить конфигурационные файлы с секретами в .gitignore, чтобы избежать их случайной публикации.

## TODO
Определить, какой подход будет использоваться для управления секретами. Рекомендуется использовать переменные окружения как минимальный подход и рассмотреть специализированные системы управления секретами для production-среды.