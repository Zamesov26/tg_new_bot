# DR-0008. Дублирование кода для построения URL запросов

## Заголовок
Дублирование кода для построения URL запросов к Telegram API

## Контекст
В проекте обнаружено дублирование кода для построения URL запросов:
1. В `app/tg_api/accessor.py` есть метод `_build_query` и метод `build_url`
2. В `message_service/accessor.py` есть аналогичный метод `_build_query`
3. Оба файла содержат почти идентичный код для построения URL

Эта проблема была идентифицирована как технический долг в TDR-0008 и как проблема в PDR-0008.

## Проблема / Долг
Дублирование кода увеличивает сложность поддержки, так как при внесении изменений в логику построения URL необходимо изменять код в нескольких местах. Это также увеличивает вероятность появления ошибок и усложняет тестирование.

## Возможные варианты решения

1. **Создание общего модуля для построения URL**:
   - Сильные стороны: Устранение дублирования, централизованная поддержка, легкость изменений
   - Слабые стороны: Необходимость рефакторинга существующего кода, потенциальная сложность интеграции

2. **Вынесение в базовый класс**:
   - Сильные стороны: Естественная интеграция, переиспользуемость, объектно-ориентированный подход
   - Слабые стороны: Может не подойти для модуля message_service, который не использует наследование

3. **Использование утилитарной функции**:
   - Сильные стороны: Простота реализации, минимальные изменения в архитектуре
   - Слабые стороны: Все еще требует изменений в нескольких файлах

## Принятое решение / Компромисс
TODO: Необходимо определить, как будет устранено дублирование кода для построения URL. Рекомендуется создать общую утилитарную функцию в отдельном модуле.

## Последствия
Если проблема будет решена путем создания общего модуля:
- Плюсы: Устранение дублирования, упрощение поддержки, снижение вероятности ошибок
- Минусы: Необходимость рефакторинга, потенциальные изменения в интерфейсе

Если проблема останется без изменений:
- Плюсы: Отсутствие необходимости в изменениях
- Минусы: Продолжение дублирования, усложнение поддержки, риск ошибок

## План исправления / развития
1. Создать общий модуль или базовый класс для построения URL запросов
2. Перенести общую логику в этот модуль/класс
3. Обновить оба accessor'а для использования общего кода
4. Написать тесты для проверки корректности построения URL

## Статус
Open

## Комментарии
Дублирование кода является признаком недостаточной модульности и может быть усугублено при дальнейшем росте проекта. Решение этой проблемы может быть связано с рефакторингом TgApiAccessor (DR-0004).

## TODO
Определить, как будет устранено дублирование кода для построения URL. Рекомендуется создать общую утилитарную функцию в отдельном модуле.