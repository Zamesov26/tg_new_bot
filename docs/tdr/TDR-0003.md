# TDR-0003. Незакрытые файловые дескрипторы

## Заголовок
Незакрытые файловые дескрипторы при работе с файлами

## Контекст
В `app/tg_api/accessor.py` обнаружены участки кода, где файлы открываются с помощью `open()`, но не всегда корректно закрываются:
1. В методе `send_photo` файл открывается через `open(path_image, "rb")`, но не закрывается явно
2. В методе `send_media_group` файлы открываются в цикле, но закрываются только в блоке `finally` после запроса
3. В методе `edit_message_media` файл открывается через `open(file_path, "rb")`, но не закрывается явно

## Долг
Использование функции `open()` без гарантии закрытия файлового дескриптора может привести к утечке ресурсов. В долгоживущих приложениях, таких как Telegram-боты, это может со временем привести к исчерпанию доступных файловых дескрипторов и сбоям приложения.

## Влияние
1. Утечка файловых дескрипторов
2. Потенциальные сбои приложения при исчерпании файловых дескрипторов
3. Несоответствие лучшим практикам работы с файлами
4. Потенциальные проблемы с производительностью

## План исправления
1. Заменить использование `open()` на контекстные менеджеры (`with` statement)
2. Убедиться, что все открытые файлы корректно закрываются даже в случае исключений
3. Проверить все места в коде, где используются файловые операции
4. Добавить тесты для проверки корректного закрытия файловых дескрипторов